<!DOCTYPE html>
<html>
<head>
    <title>ehè§£æä¸å½’æ¡£</title>
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <meta property="og:title" content="ehè§£æä¸å½’æ¡£">
    <meta property="og:description" content="è§£æå½’æ¡£è·å–é“¾æ¥ä¸API">
    <meta property="og:image" content="/static/favicon.ico">
    <meta property="og:url" content="https://eh-arc-api.mhdy.icu">
    <meta property="og:type" content="website">
    <!-- Twitter Cards -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="ehè§£æä¸å½’æ¡£">
    <meta name="twitter:description" content="è§£æå½’æ¡£è·å–é“¾æ¥ä¸API">
    <meta name="twitter:image" content="/static/favicon.ico">
    <meta name="twitter:url" content="https://eh-arc-api.mhdy.icu">
    <meta name='description' content='è§£æå½’æ¡£è·å–é“¾æ¥ä¸API'>
    <style>
        /* ä¿è¯è‡ªåŠ¨æ¢è¡Œ */
        .text-wrap {
            white-space: normal;
            word-break: break-word;
        }
        
        /* é™åˆ¶å®½åº¦æœ€å¤§å€¼ï¼Œæ”¯æŒè‡ªé€‚åº” */
        .title-limit {
            max-width: 100%;        /* ä¸è¶…è¿‡çˆ¶å®¹å™¨ */
            min-width: 0;
            display: block;         /* å…è®¸å¤šè¡Œæ’‘å¼€ */
            -webkit-line-clamp: 2;
            font-size: 1rem;
            line-height: 1.2;
        }

        .card-img-top {
            width: 100%;
            height: 200px;               /* å›ºå®šé«˜åº¦æˆ–ä½¿ç”¨ max-height */
            object-fit: contain;           /* ç¼©æ”¾ */
            border-radius: 6px;          /* å¯é€‰ï¼ŒåŠ ç‚¹åœ†è§’ */
        }

        /* æ¯è¡Œæ˜¾ç¤º5åˆ—ï¼ˆè‡ªå®šä¹‰ç±»ï¼‰ */
        @media (min-width: 992px) {
        .col-lg-2-4 {
            flex: 0 0 20%;
            max-width: 20%;
        }
        }

        #api-form input {
            font-size: 14px;
        }
        .card-title {
        font-size: 18px;
        }

        /* æ˜¾ç¤ºå®Œæ•´å›¾ç‰‡ï¼Œä¸è£å‰ª */
        .card-img-top-contain {
            object-fit: contain !important;
            height: auto;
            max-height: 300px;
            width: 100%;
            background-color: #f8f9fa;
        }

        /* ç¼©å°å¡ç‰‡å­—ä½“ */
        .card-body {
            font-size: 14px;
            line-height: 1.3;
        }

        /* tagè¡Œæ’ç‰ˆ */
        .tag-line {
            margin-bottom: 0.25rem;
        }

        .row {
            display: flex;
        }

        /* å®¹å™¨æ ·å¼ */
        .custom-switch-wrapper {
        font-size: 1rem;
        }

        /* æ ‡ç­¾æ–‡å­—ç»Ÿä¸€æ ·å¼ */
        .switch-label {
        font-weight: 500;
        color: #666;
        }

        /* å¼€å…³å®¹å™¨ */
        .custom-switch {
        position: relative;
        display: inline-block;
        width: 48px;
        height: 26px;
        }

        /* éšè—åŸå§‹ checkbox */
        .custom-switch input {
        opacity: 0;
        width: 0;
        height: 0;
        }

        /* æ»‘å—è½¨é“æ ·å¼ */
        .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 34px;
        }

        /* æ»‘å—åœ†ç‚¹ */
        .slider::before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 3px;
        top: 3px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
        }

        /* é€‰ä¸­çŠ¶æ€ */
        .custom-switch input:checked + .slider {
        background-color: #0d6efd;
        }

        .custom-switch input:checked + .slider::before {
        transform: translateX(22px);
        }
        </style>

</head>
<body class="p-5">
    <div class="container mt-5">
        <div class="container mt-5">
            <div class="row">
                <!-- å·¦ä¾§ï¼šä¸¤ä¸ªå¡ç‰‡çºµå‘æ’åˆ— -->
                <div class="col-md-4 d-flex flex-column gap-3">
                    <div class="card shadow-sm">
                        <div class="card-body">
                        <h5 class="card-title">ğŸŒ è§£æ ç”»å»Š</h5>
                        <form id="api-form">
                            <input type="text" name="link" id="parse_link" placeholder="è¾“å…¥ ç”»å»Š é“¾æ¥" class="form-control mb-2" required>
                            <button type="button" id="parse" class="btn btn-primary w-100">è§£æ ç”»å»Š</button>
                        </form>
                        </div>
                    </div>
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title">ğŸ§ª ç”»å»Šå½’æ¡£</h5>
                            <input type="text" name="link" id="arc_link" placeholder="è¾“å…¥ ç”»å»Š é“¾æ¥" class="form-control mb-2" required>
                            <input type="text" name="link" id="api_key" placeholder="è¾“å…¥ api key (å¯é€‰)" class="form-control mb-2">
                            <button type="button" id="arc" class="btn btn-primary w-100">è·å–å½’æ¡£é“¾æ¥</button>
                            <div class="custom-switch-wrapper d-flex align-items-center mb-3">
                                <span class="switch-label me-2">åŸå›¾</span>
                                <label class="custom-switch">
                                <input type="checkbox" id="advancedSwitch">
                                <span class="slider"></span>
                            </label>
                            <span class="switch-label ms-2 text-primary">é‡é‡‡æ ·</span>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- å³ä¾§ï¼šAPI è¿”å›å±•ç¤ºåŒºåŸŸ -->
                <div class="col-md-8">
                <div id="api-result-container" class="row gy-4">
                    <!-- åŠ¨æ€æ’å…¥å¡ç‰‡ -->
                </div>
                </div>
            </div>
        </div>
    </div>
    
    <h2 align="center">ğŸ”¥ çƒ­é—¨å½’æ¡£å±•ç¤º</h2>
    <div class="container mt-4">
        <div class="row g-3">
            {% for item in hot_data %}
                <div class="col-6 col-lg-2-4"> <!-- æˆ‘ä¼šè§£é‡Šè¿™ä¸ªâ€œ2-4â€å†™æ³• -->
                <div class="card h-100">
                    <div class="card-body p-2">
                        <p class="card-text text-muted small">ID: {{ item.id }}</p>
                        <p class="card-text text-muted small">å½’æ¡£æ¬¡æ•°: {{ item.count }}</p>
                        <h6 class="card-title text-wrap title-limit" style="font-size: 14px;"><a href="{{ item.url }}">{{ item.title }}</a></h6>
                        <!-- å¯åŠ æŒ‰é’®æˆ–è¯„åˆ† -->
                    </div>
                    <a href = "{{ item.url }}">
                        <img src="{{ item.image_url }}" class="card-img-top">
                    </a>
                </div>
                </div>
            {% endfor %}
        </div>
    </div>
    <hr>
    <h2 align="center">ğŸ“‹ æœ€è¿‘å½’æ¡£å±•ç¤º</h2>
    <div class="container mt-4">
        <div class="row g-3">
            {% for item in data %}
                <div class="col-6 col-lg-2-4"> <!-- æˆ‘ä¼šè§£é‡Šè¿™ä¸ªâ€œ2-4â€å†™æ³• -->
                <div class="card h-100">
                    <div class="card-body p-2">
                        <p class="card-text text-muted small">ID: {{ item.id }}</p>
                        <p class="card-text text-muted small">æ¥æº: {{ item.log_type }}</p>
                        <h6 class="card-title text-wrap title-limit" style="font-size: 14px;"><a href="{{ item.url }}">{{ item.title1 }}</a></h6>
                        <!-- å¯åŠ æŒ‰é’®æˆ–è¯„åˆ† -->
                    </div>
                    <a href = "{{ item.url }}">
                        <img src="{{ item.image_url }}" class="card-img-top">
                    </a>
                </div>
                </div>
            {% endfor %}
        </div>
    </div>

        <script>
            document.getElementById("parse").addEventListener("click", async function (e) {
                e.preventDefault();
                const link = document.getElementById("parse_link").value;
            
                const res = await fetch("/parse", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: new URLSearchParams({ link: link })
                });
            
                let data;
                try {
                    data = await res.json();
                } catch (e) {
                    data = null;  // JSON è§£æå¤±è´¥ï¼Œæ¯”å¦‚æ˜¯å­—ç¬¦ä¸²ï¼Œå¼ºåˆ¶è®¾ä¸º null
                }
                
                const container = document.getElementById("api-result-container");
                if (!data || typeof data !== "object") {
                    container.innerHTML = `
                        <div class="col-auto">
                            <div class="card shadow-sm fixed-width-card">
                                <div class="card-body">
                                    <h6 class="card-title mb-2 text-danger">âš ï¸ æ— æ³•è·å–æœ‰æ•ˆæ•°æ®</h6>
                                    <p class="card-text">è¿”å›çš„æ•°æ®ä¸ºç©ºï¼Œæˆ–è€…æ ¼å¼é”™è¯¯ã€‚è¯·ç¡®è®¤é“¾æ¥æ˜¯å¦æœ‰æ•ˆã€‚</p>
                                </div>
                            </div>
                        </div>
                    `;
                    return;
                }
                container.innerHTML = `
                    <div class="col-auto">
                        <div class="card shadow-sm fixed-width-card">
                        <img src="${data.image_url}" class="card-img-top card-img-top-contain" alt="å›¾ç‰‡">
                        <div class="card-body">
                            <h6 class="card-title mb-2">${data.title}</h6>
                            <p class="card-text"><strong>ä¸Šä¼ è€…:</strong> ${data.uploader}</p>
                            <p class="card-text"><strong>ç”»å»Šç±»å‹:</strong> ${data.page_type}</p>
                            <p class="card-text"><strong>ä¸Šä¼ æ—¶é—´:</strong> ${data.posted}</p>
                            <p class="card-text"><strong>å¤§å°:</strong> ${data.size}</p>
                            <p class="card-text"><strong>é¡µæ•°:</strong> ${data.pages}</p>
                            <p class="card-text"><strong>è¯„åˆ†:</strong> ${data.average}</p>
                            <p class="card-text"><strong>tags:</strong></p>
                            <div class="card-text">
                            ${Object.entries(data.labels)
                                .map(([key, values]) =>
                                `<div class="tag-line"><strong>${key}ï¼š</strong> ${values.map(v => `<span class="badge bg-dark me-1">${v}</span>`).join("")}</div>`
                                ).join("")}
                            </div>
                        </div>
                        </div>
                    </div>
                    `;
            });
            document.getElementById("arc").addEventListener("click", async function (e) {
                e.preventDefault();
                const link = document.getElementById("arc_link").value;
                const api_Key = document.getElementById("api_key").value;
                const isToggled = document.getElementById("advancedSwitch").checked;
            
                const res = await fetch("/arc", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: new URLSearchParams({ link: link, clarity: isToggled, api_key: api_Key })
                });
                let data;
                try {
                    data = await res.json();
                } catch (e) {
                    data = null;  // JSON è§£æå¤±è´¥ï¼Œæ¯”å¦‚æ˜¯å­—ç¬¦ä¸²ï¼Œå¼ºåˆ¶è®¾ä¸º null
                }
                const container = document.getElementById("api-result-container");
                if (!data || typeof data !== "object") {
                    container.innerHTML = `
                        <div class="col-auto">
                            <div class="card shadow-sm fixed-width-card">
                                <div class="card-body">
                                    <h6 class="card-title mb-2 text-danger">âš ï¸ æ— æ³•è·å–æœ‰æ•ˆæ•°æ®</h6>
                                    <p class="card-text">è¿”å›çš„æ•°æ®ä¸ºç©ºï¼Œæˆ–è€…æ ¼å¼é”™è¯¯ã€‚è¯·ç¡®è®¤é“¾æ¥æ˜¯å¦æœ‰æ•ˆã€‚</p>
                                </div>
                            </div>
                        </div>
                    `;
                    return;
                }
                if (!data || typeof data !== "object" || data.code === 429) {
                    const message = data?.msg || "è¿”å›çš„æ•°æ®ä¸ºç©ºï¼Œæˆ–è€…æ ¼å¼é”™è¯¯ã€‚è¯·ç¡®è®¤é“¾æ¥æ˜¯å¦æœ‰æ•ˆã€‚";
                    container.innerHTML = `
                        <div class="col-auto">
                            <div class="card shadow-sm fixed-width-card">
                                <div class="card-body">
                                    <h6 class="card-title mb-2 text-danger">âš ï¸ æ— æ³•è·å–æœ‰æ•ˆæ•°æ®</h6>
                                    <p class="card-text">${message}</p>
                                </div>
                            </div>
                        </div>
                    `;
                    return;
                }
                container.innerHTML = `
                    <div class="col-auto">
                        <div class="card shadow-sm fixed-width-card">
                            <img src="${data.image_url}" class="card-img-top card-img-top-contain" alt="å›¾ç‰‡">
                            <div class="card-body">
                                <h6 class="card-title mb-2">${data.title1}</h6>
                                <h7 class="card-title mb-2">${data.title2}</h7>
                                <br>
                                <p class="card-text">ä½¿ç”¨GP: <b>${data.use_gp}</b> ${data.user_gp? `å‰©ä½™GP: <b>${data.user_gp}</b>` : ""} ${data.use_num? `ä½¿ç”¨æ¬¡æ•°: <b>${data.use_num}</b>`: ""}</p>
                                <p>ä¸‹è½½é“¾æ¥: <a href="${data.download_url}">${data.download_url}</a></p>
                                <br>
                                <p>?å·å‰æ•°å­—ä¸º0-3, åˆ†åˆ«ä¸ºè‹±æ–‡åŸå›¾, è‹±æ–‡é‡é‡‡æ ·, æ—¥æ–‡åŸå›¾, æ—¥æ–‡é‡é‡‡æ ·å¯ä»¥è‡ªå·±æ ¹æ®éœ€è¦ä¿®æ”¹(ä¸ç”¨è¯•äº†ä¸å­˜åœ¨ç™½å«–GPçš„bug)</p>
                            </div>
                        </div>
                    </div>
                `;
            });
        </script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
    <title>æ•°æ®åº“å±•ç¤º + APIè°ƒç”¨</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        /* ä¿è¯è‡ªåŠ¨æ¢è¡Œ */
        .text-wrap {
            white-space: normal;
            word-break: break-word;
        }
        
        /* é™åˆ¶å®½åº¦æœ€å¤§å€¼ï¼Œæ”¯æŒè‡ªé€‚åº” */
        .title-limit {
            max-width: 100%;        /* ä¸è¶…è¿‡çˆ¶å®¹å™¨ */
            min-width: 0;
            display: block;         /* å…è®¸å¤šè¡Œæ’‘å¼€ */
            -webkit-line-clamp: 2;
            font-size: 1rem;
            line-height: 1.2;
        }

        .card-img-top {
            width: 100%;
            height: 200px;               /* å›ºå®šé«˜åº¦æˆ–ä½¿ç”¨ max-height */
            object-fit: contain;           /* ç¼©æ”¾ */
            border-radius: 6px;          /* å¯é€‰ï¼ŒåŠ ç‚¹åœ†è§’ */
        }

        /* æ¯è¡Œæ˜¾ç¤º5åˆ—ï¼ˆè‡ªå®šä¹‰ç±»ï¼‰ */
        @media (min-width: 992px) {
        .col-lg-2-4 {
            flex: 0 0 20%;
            max-width: 20%;
        }
        }

        #api-form input {
            font-size: 14px;
        }
        .card-title {
        font-size: 18px;
        }

        /* æ˜¾ç¤ºå®Œæ•´å›¾ç‰‡ï¼Œä¸è£å‰ª */
        .card-img-top-contain {
            object-fit: contain !important;
            height: auto;
            max-height: 300px;
            width: 100%;
            background-color: #f8f9fa;
        }

        /* ç¼©å°å¡ç‰‡å­—ä½“ */
        .card-body {
            font-size: 14px;
            line-height: 1.3;
        }

        /* tagè¡Œæ’ç‰ˆ */
        .tag-line {
            margin-bottom: 0.25rem;
        }
        </style>

</head>
<body class="p-5">
    <div class="container mt-5">
        <div class="row">
            <!-- å·¦ä¾§ï¼šAPI è¾“å…¥å¡ç‰‡ -->
            <div class="col-md-4">
                <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">ğŸŒ è§£æ ç”»å»Š</h5>
                    <form id="api-form">
                    <input type="text" name="link" id="link" placeholder="è¾“å…¥ ç”»å»Š é“¾æ¥" class="form-control mb-2" required>
                    <button type="submit" class="btn btn-primary w-100">è§£æ ç”»å»Š</button>
                    </form>
                </div>
                </div>
            </div>
        
            <!-- å³ä¾§ï¼šAPI è¿”å›å±•ç¤ºåŒºåŸŸ -->
            <div class="col-md-8">
                <div id="api-result-container" class="row gy-4">
                <!-- åŠ¨æ€æ’å…¥å¡ç‰‡ -->
                </div>
            </div>
        </div>
    </div>
    
    <h2 align="center">ğŸ“‹ æœ€è¿‘å½’æ¡£å±•ç¤º</h2>
    <div class="container mt-4">
        <div class="row g-3">
            {% for item in data %}
                <div class="col-6 col-lg-2-4"> <!-- æˆ‘ä¼šè§£é‡Šè¿™ä¸ªâ€œ2-4â€å†™æ³• -->
                <div class="card h-100">
                    <div class="card-body p-2">
                        <p class="card-text text-muted small">ID: {{ item.id }}</p>
                        <h6 class="card-title text-wrap title-limit" style="font-size: 14px;"><a href="{{ item.url }}">{{ item.title1 }}</a></h6>
                        <!-- å¯åŠ æŒ‰é’®æˆ–è¯„åˆ† -->
                    </div>
                    <a href = "{{ item.url }}">
                        <img src="{{ item.image_url }}" class="card-img-top">
                    </a>
                </div>
                </div>
            {% endfor %}
            </div>
        </div>

        <script>
            document.getElementById("api-form").addEventListener("submit", async function (e) {
                e.preventDefault();
                const link = document.getElementById("link").value;
            
                const res = await fetch("/parse", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: new URLSearchParams({ link: link })
                });
            
                const data = await res.json();  // âœ… ç¡®è®¤æ˜¯è¿™ä¸ªç»“æ„ï¼
            
                const container = document.getElementById("api-result-container");
                container.innerHTML = `
                    <div class="col-auto">
                        <div class="card shadow-sm fixed-width-card">
                        <img src="${data.image_url}" class="card-img-top card-img-top-contain" alt="å›¾ç‰‡">
                        <div class="card-body">
                            <h6 class="card-title mb-2">${data.title}</h6>
                            <p class="card-text"><strong>ä¸Šä¼ è€…:</strong> ${data.uploader}</p>
                            <p class="card-text"><strong>ç”»å»Šç±»å‹:</strong> ${data.page_type}</p>
                            <p class="card-text"><strong>ä¸Šä¼ æ—¶é—´:</strong> ${data.posted}</p>
                            <p class="card-text"><strong>å¤§å°:</strong> ${data.size}</p>
                            <p class="card-text"><strong>é¡µæ•°:</strong> ${data.pages}</p>
                            <p class="card-text"><strong>è¯„åˆ†:</strong> ${data.average}</p>
                            <p class="card-text"><strong>tags:</strong></p>
                            <div class="card-text">
                            ${Object.entries(data.labels)
                                .map(([key, values]) =>
                                `<div class="tag-line"><strong>${key}ï¼š</strong> ${values.map(v => `<span class="badge bg-dark me-1">${v}</span>`).join("")}</div>`
                                ).join("")}
                            </div>
                        </div>
                        </div>
                    </div>
                    `;
            });
            </script>
</body>
</html>
